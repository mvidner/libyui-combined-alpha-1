From 6d9694134f2fa7510100f430e10044782069895e Mon Sep 17 00:00:00 2001
From: Dinar Valeev <dvaleev@suse.de>
Date: Fri, 10 Jan 2014 14:34:36 +0100
Subject: [PATCH] use cgraph instead of graph interfaces

Signed-off-by: Dinar Valeev <dvaleev@suse.com>
---
 examples/SimpleCreate.cc | 18 ++++++++++++++++++
 src/QY2Graph.cc          |  8 ++++++++
 2 files changed, 26 insertions(+)

diff --git a/examples/SimpleCreate.cc b/examples/SimpleCreate.cc
index 2dcf8fa..03ebc23 100644
--- a/examples/SimpleCreate.cc
+++ b/examples/SimpleCreate.cc
@@ -45,6 +45,23 @@
 
     GVC_t* gvc = gvContext();
 
+#ifdef WITH_CGRAPH
+    graph_t* graph = agopen(strdup("test"), Agdirected, 0);
+
+    node_t* node1 = agnode(graph, strdup("1"), 1);
+    node_t* node2 = agnode(graph, strdup("2"), 1);
+
+    agattr(graph, AGNODE, strdup("fillcolor"), strdup("gray"));
+    agset(node1, strdup("fillcolor"), strdup("red"));
+    agset(node2, strdup("fillcolor"), strdup("green"));
+
+    edge_t* edge1 = agedge(graph, node1, node2, NULL, 1);
+    edge_t* edge2 = agedge(graph, node2, node1, NULL, 1);
+
+    agattr(graph, AGEDGE, strdup("color"), strdup("black"));
+    agset(edge1, strdup("color"), strdup("red"));
+    agset(edge2, strdup("color"), strdup("green"));
+#else
     graph_t* graph = agopen(strdup("test"), AGDIGRAPH);
 
     node_t* node1 = agnode(graph, strdup("1"));
@@ -60,6 +77,7 @@
     agedgeattr(graph, strdup("color"), strdup("black"));
     agset(edge1, strdup("color"), strdup("red"));
     agset(edge2, strdup("color"), strdup("green"));
+#endif
 
     gvLayout(gvc, graph, "dot");
 
diff --git a/src/QY2Graph.cc b/src/QY2Graph.cc
index 46fdcbe..873191e 100644
--- a/src/QY2Graph.cc
+++ b/src/QY2Graph.cc
@@ -224,7 +224,11 @@
 	GVC_t* gvc = gvContext();
 	if (gvc != NULL)
 	{
+#ifdef WITH_CGRAPH
+	    graph_t* graph = agread(fp, NULL);
+#else
 	    graph_t* graph = agread(fp);
+#endif
 	    if (graph != NULL)
 	    {
 		if (gvLayout(gvc, graph, const_cast<char*>(layoutAlgorithm.c_str())) == 0)
@@ -375,7 +379,11 @@
 	drawLabel(ND_label(node), &painter);
 	painter.end();
 
+#ifdef WITH_CGRAPH
+	QY2Node* item = new QY2Node(makeShape(node), picture, agnameof(node));
+#else
 	QY2Node* item = new QY2Node(makeShape(node), picture, node->name);
+#endif
 
 	item->setPos(gToQ(ND_coord(node)));
 
-- 
1.8.4

